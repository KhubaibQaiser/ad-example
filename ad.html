<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Shopsense - Embeds</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="displayheight" content="160, 1094" />
    <link rel="stylesheet" href="ad.css" />
  </head>
  <body>
    <main class="carousel">
      <div class="main-bg"></div>
      <div id="products"></div>
      <div class="bottom-highlight"></div>
      <div id="splash-img" class="splash">
        <img src="logo.svg" width="100%" alt="Shopsense" />
      </div>
    </main>

    <script>
      function getSuggestionElement(suggestion) {
        return `<a href="${suggestion.url}" target="_blank"> <img src="${suggestion.img}" alt="${suggestion.name}" class="suggestion" /> </a>`;
      }
      function getProductElement({ product }) {
        return `<section class="product-section"><div class="bg-overlay-container" style="background-color: ${product.bgColor}"> <div class="bg-overlay"></div> <div class="bg-overlay-bottom"></div> </div> <div class="bg-overlay-blend"></div> <img src="${product.img}" alt="${product.name}" class="product-img" /> <div class="suggestions"> <div class="suggestions-wrapper">{{suggestions-placeholder}}</div></div></section>`;
      }

      function generateAd(products) {
        var productsStr = '';
        products.forEach((product) => {
          const productStr = getProductElement(product);
          productsStr += productStr.replace('{{suggestions-placeholder}}', product.suggestions.map(getSuggestionElement).join(''));
        });
        document.getElementById('products').innerHTML = productsStr;
      }

      function initAds(adsData) {
        generateAd(adsData);
        initCarouse();
        setTimeout(() => {
          document.getElementById('splash-img').classList.add('hidden');
        }, 1000);
      }

      function initCarouse() {
        const carousel = document.querySelector('.carousel');
        const slides = document.querySelectorAll('.product-section');
        const numSlides = slides.length;
        let interval;
        const delay = 3; // seconds
        let currentIndex = 0;

        function showSlide(index) {
          if (slides.length === 1) {
            slides[0].classList.add('active');
            return;
          }

          slides.forEach((slide, i) => {
            slide.classList.remove('active', 'prev');
            if (i === index) {
              slide.classList.add('active');
            } else if (i === (index - 1 + numSlides) % numSlides) {
              slide.classList.add('prev');
            }
          });
        }

        function nextSlide() {
          currentIndex = (currentIndex + 1) % numSlides;
          showSlide(currentIndex);
        }

        function stopCarousel() {
          clearInterval(interval);
        }

        function startCarousel() {
          interval = setInterval(nextSlide, (delay + 1) * 1000);
        }

        if (slides.length > 1) {
          carousel.addEventListener('mouseenter', stopCarousel);
          carousel.addEventListener('mouseleave', startCarousel);
        }

        showSlide(currentIndex);
        startCarousel();
      }

      document.addEventListener('DOMContentLoaded', async () => {
        await fetch('config.json')
          .then((response) => response.json())
          .then(initAds)
          .catch((error) => {
            console.error('Error fetching data:', error);
          });
      });
    </script>
  </body>
</html>
