!function(){window.ShopsenseEmbeds=window.ShopsenseEmbeds||{},window.ShopsenseEmbeds.env="production";const e="0123456789ABCDEFGHJKMNPQRSTVWXYZ";function t(){const t=function(t,n){let s="";for(;n--;)s=e[t%32]+s,t=Math.floor(t/32);return s}(Date.now(),10);let n="";for(let t=0;t<16;t++)n+=e[Math.floor(32*Math.random())];return t+n}window.ShopsenseEmbeds.getUtmParams=()=>{const e=new URLSearchParams(window.location.search);if(!e||!e.get("utm_source")){const e=Object.keys(window.ShopsenseEmbeds.trackingData),t={};return e.forEach((e=>{e.includes("utm_")&&(t[e]=window.ShopsenseEmbeds.trackingData[e])})),t}return{utm_source:e.get("utm_source"),utm_medium:e.get("utm_medium"),utm_campaign:e.get("utm_campaign"),utm_term:e.get("utm_term"),utm_content:e.get("utm_content")}};const n=e=>{if(window.ShopsenseEmbeds.utmParams=e||{},Object.values(window.ShopsenseEmbeds.utmParams).length){const e=new amplitude.Identify;for(const[t,n]of Object.entries(window.ShopsenseEmbeds.utmParams))n&&e.set(t,n);window.ShopsenseEmbeds.amplitude.identify(e)}},s=()=>{window.ShopsenseEmbeds.amplitude=window.amplitude||{},window.ShopsenseEmbeds.amplitude.init("7f43e3804ae8258217c76786327d76a8",{autocapture:!1,includeUtm:!0,trackingOptions:{deviceModel:!1,deviceId:!1,osName:!1,osVersion:!1,os:!1,family:!1,platform:!1,ipAddress:!1}}),window.addEventListener("message",(e=>{e&&e.data&&"object"==typeof e.data&&!Array.isArray(e.data)&&Object.keys(e.data).length&&"utm_source"in e.data&&n(e.data)})),window.ShopsenseEmbeds.trackingData={session_id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),ad_id:"",campaign_id:"",utm_source:"tastemade",utm_medium:"shopsense_embed",utm_campaign:"walnut-cake",utm_term:"",utm_content:""},n(window.ShopsenseEmbeds.getUtmParams())},o=(e,n={})=>{const s={...window.ShopsenseEmbeds.trackingData,display_id:`${window.ShopsenseEmbeds.trackingData.session_id}-${(new Date).toISOString()}`,referrer_domain:window.location.hostname},o=e?.toLowerCase()?.includes("click"),d=n.product,i={};d&&(i.product_id=d.id,i.product_name=d.display_name,i.retailer_name=d.retailer?.name,i.retailer_id=d.retailer?.id,i.affiliate=d.retailer?.affiliate?.handle);const a={};if(o){const e=t();a.tracking_id=e,a.ad_click_event_tracking_id=window.ShopsenseEmbeds.getTrackingUrl({ulid:e,product:d,isProd:"production"===window.ShopsenseEmbeds.env})}return"product"in n&&delete n.product,{...s,...i,...a}};var d={};window.ShopsenseEmbeds.analytics={logEvent:(e,t={})=>{const n=`Embed - ${e}`,s=`${n}${JSON.stringify(t)}`;d[s]||(d[s]=JSON.stringify(t),"production"===window.ShopsenseEmbeds.env&&window.ShopsenseEmbeds.amplitude.logEvent(n,o(e,t)))}},document.addEventListener("DOMContentLoaded",s),document.addEventListener("ShopsenseEmbedInjected",s)}();